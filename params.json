{
  "name": "fluent-plugin-azure-loganalytics",
  "tagline": "Azure Log Analytics output plugin for Fluentd",
  "body": "# fluent-plugin-azure-loganalytics\r\n[Azure Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-overview) output plugin for Fluentd. The plugin aggregates semi-structured data in real-time and writes the buffered data via HTTPS request to Azure Log Analytics.\r\n\r\n![fluent-plugin-azure-loganalytics overview](https://github.com/yokawasa/fluent-plugin-azure-loganalytics/raw/master/img/Azure-LogAnalytics-Fluentd.png)\r\n\r\n## Installation\r\n```\r\n$ gem install fluent-plugin-azure-loganalytics\r\n```\r\n\r\n## Configuration\r\n\r\n### Azure Log Analytics\r\nTo start running with Log Analytics in the Microsoft Operations Management Suite (OMS), You need to create either an OMS workspace using the OMS website or Log Analytics workspace using your Azure subscription. Workspaces created either way are functionally equivalent. Here is an instruction:\r\n\r\n * [Get started with Log Analytics](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-get-started)\r\n\r\nOnce you have the workspace, get Workspace ID and Shared Key (either Primary Key or Secondary Key), which are needed by [Log Analytics HTTP Data Collector API](https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-data-collector-api) to post the data to Log Analytics.\r\n\r\n\r\n### Fluentd - fluent.conf\r\n\r\n```\r\n<match azure-loganalytics.**>\r\n    @type azure-loganalytics\r\n    customer_id CUSTOMER_ID   # Customer ID aka WorkspaceID String\r\n    shared_key KEY_STRING     # The primary or the secondary Connected Sources client authentication key\r\n    log_type EVENT_TYPE_NAME  # The name of the event type. ex) ApacheAccessLog\r\n    add_time_field true\r\n    time_field_name mytime\r\n    time_format %s\r\n    localtime true\r\n    add_tag_field true\r\n    tag_field_name mytag\r\n</match>\r\n```\r\n\r\n * **customer\\_id (required)** - Your Operations Management Suite workspace ID\r\n * **shared\\_key (required)** - The primary or the secondary Connected Sources client authentication key\r\n * **log\\_type (required)** - The name of the event type that is being submitted to Log Analytics\r\n * **add\\_time\\_field (optional)** - Default:true. This option allows to insert a time field to record\r\n * **time\\_field\\_name (optional)** - Default:time. This is required only when add_time_field is true\r\n * **localtime (optional)** - Default:false. Time record is inserted with UTC (Coordinated Universal Time) by default. This option allows to use local time if you set localtime true. This is valid only when add_time_field is true\r\n * **time\\_format (optional)** -  Default:%s. Time format for a time field to be inserted. Default format is %s, that is unix epoch time. If you want it to be more human readable, set this %Y%m%d-%H:%M:%S, for example. This is valid only when add_time_field is true.\r\n * **add\\_tag\\_field (optional)** - Default:false. This option allows to insert a tag field to record\r\n * **tag\\_field\\_name (optional)** - Default:tag. This is required only when add_time_field is true\r\n\r\n\r\n## Configuration examples\r\n\r\nfluent-plugin-azure-loganalytics adds **time** and **tag** attributes by default if **add_time_field** and **add_tag_field** are true respectively. Below are two types of the plugin configurations - Default and All options configuration.\r\n\r\n### (1) Default Configuration (No options)\r\n<u>fluent.conf</u>\r\n```\r\n<source>\r\n    @type tail                         # input plugin\r\n    path /var/log/apache2/access.log   # monitoring file\r\n    pos_file /tmp/fluentd_pos_file     # position file\r\n    format apache                      # format\r\n    tag azure-loganalytics.access      # tag\r\n</source>\r\n\r\n<match azure-loganalytics.**>\r\n    @type azure-loganalytics\r\n    customer_id 818f7bbc-8034-4cc3-b97d-f068dd4cd658\r\n    shared_key ppC5500KzCcDsOKwM1yWUvZydCuC3m+ds/2xci0byeQr1G3E0Jkygn1N0Rxx/yVBUrDE2ok3vf4ksCzvBmQXHw==(dummy)\r\n    log_type ApacheAccessLog\r\n</match>\r\n```\r\n\r\n### (2) Configuration with All Options\r\n<u>fluent.conf</u>\r\n```\r\n<source>\r\n    @type tail                         # input plugin\r\n    path /var/log/apache2/access.log   # monitoring file\r\n    pos_file /tmp/fluentd_pos_file     # position file\r\n    format apache                      # format\r\n    tag azure-loganalytics.access      # tag\r\n</source>\r\n\r\n<match azure-loganalytics.**>\r\n    @type azure-loganalytics\r\n    customer_id 818f7bbc-8034-4cc3-b97d-f068dd4cd658\r\n    shared_key ppC5500KzCcDsOKwM1yWUvZydCuC3m+ds/2xci0byeQr1G3E0Jkygn1N0Rxx/yVBUrDE2ok3vf4ksCzvBmQXHw==(dummy)\r\n    log_type ApacheAccessLog\r\n    add_time_field true\r\n    time_field_name mytime\r\n    time_format %s\r\n    localtime true\r\n    add_tag_field true\r\n    tag_field_name mytag\r\n</match>\r\n```\r\n\r\n## Sample inputs and expected records\r\n\r\nAn expected output record for sample input will be like this:\r\n\r\n<u>Sample Input (apache access log)</u>\r\n```\r\n124.211.152.156 - - [10/Dec/2016:05:28:52 +0000] \"GET /test/foo.html HTTP/1.1\" 200 323 \"-\" \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36\"\r\n```\r\n\r\n<u>Output Record</u>\r\n\r\nThe output record for sample input can be seen at Log Analytics portal like this:\r\n\r\n![fluent-plugin-azure-loganalytics output image](https://github.com/yokawasa/fluent-plugin-azure-loganalytics/raw/master/img/Azure-LogAnalytics-Output-Image.png)\r\n\r\n\r\n## Tests\r\n### Running test code\r\n```\r\n$ git clone https://github.com/yokawasa/fluent-plugin-azure-loganalytics.git\r\n$ cd fluent-plugin-azure-loganalytics\r\n\r\n# edit CONFIG params of test/plugin/test_azure_loganalytics.rb\r\n$ vi test/plugin/test_azure_loganalytics.rb\r\n\r\n# run test\r\n$ rake test\r\n```\r\n\r\n### Creating package, running and testing locally\r\n```\r\n$ rake build\r\n$ rake install:local\r\n\r\n# running fluentd with your fluent.conf\r\n$ fluentd -c fluent.conf -vv &\r\n\r\n# send test apache requests for testing plugin ( only in the case that input source is apache access log )\r\n$ ab -n 5 -c 2 http://localhost/test/foo.html\r\n```\r\n\r\n## Change log\r\n* [Changelog](ChangeLog.md)\r\n\r\n## Links\r\n\r\n* http://yokawasa.github.io/fluent-plugin-azure-loganalytics\r\n* https://rubygems.org/gems/fluent-plugin-azure-loganalytics\r\n* https://rubygems.org/gems/azure-loganalytics-datacollector-api\r\n\r\n## Contributing\r\n\r\nBug reports and pull requests are welcome on GitHub at https://github.com/yokawasa/fluent-plugin-azure-loganalytics.\r\n\r\n## Copyright\r\n\r\n<table>\r\n  <tr>\r\n    <td>Copyright</td><td>Copyright (c) 2016- Yoichi Kawasaki</td>\r\n  </tr>\r\n  <tr>\r\n    <td>License</td><td>Apache License, Version 2.0</td>\r\n  </tr>\r\n</table>\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}